import{c as Q,e as O,h as B,r as N}from"./chunk-VBC45PGF.js";import{d as H,e as R,h as V}from"./chunk-Q3OPCDQA.js";import"./chunk-OZO3W66J.js";import{c as I,f as j}from"./chunk-B24EO72Z.js";import{$a as o,Bb as M,Db as L,Fa as h,Ma as a,Na as b,Za as p,_ as w,cc as T,db as n,dc as q,eb as r,fb as c,fc as D,ga as C,ha as _,ia as f,ib as y,ja as v,jb as d,kb as x,sb as l,tb as P,ub as S,vb as k,xb as F,yb as A,zb as E}from"./chunk-HWFM7EIN.js";import"./chunk-5FZOKLP6.js";var W=s=>["/vistaconsulta",s];function $(s,m){s&1&&(n(0,"span"),l(1,"..."),r())}function z(s,m){if(s&1&&(n(0,"div",21)(1,"h3",22),c(2,"span",23),r(),n(3,"p",24),c(4,"span",23),p(5,$,2,0,"span",25),r(),n(6,"div",26)(7,"span",27),l(8," Leer m\xE1s \u2192 "),r(),n(9,"span"),l(10),r()()()),s&2){let e=m.$implicit,i=x();a(2),o("innerHTML",i.resaltarCoincidencia(e.titulo),h),a(2),o("innerHTML",i.resaltarCoincidencia(e.descripcion.slice(0,55)),h),a(),o("ngIf",e.descripcion.length>55),a(2),o("routerLink",L(5,W,e.id)),a(3),P(e.producto)}}function G(s,m){if(s&1){let e=y();n(0,"li")(1,"span",28),d("click",function(){let t=C(e).$implicit,u=x();return _(u.irAVistaConsulta(t.titulo))}),l(2),r()()}if(s&2){let e=m.$implicit;a(2),S(" ",e.titulo," ")}}var ne=(()=>{class s{constructor(e,i){this.http=e,this.router=i,this.searchQuery="",this.consultas=[],this.consultasFiltradas=[],this.consultasPorPagina=6,this.paginaActual=0,this.busquedasRecientes=[]}ngOnInit(){this.http.get("api/consultas").subscribe({next:e=>{this.consultas=e,this.consultasFiltradas=e},error:e=>{console.error("Error al cargar consultas desde la API:",e)}}),this.http.get("api/busquedas/recientes").subscribe({next:e=>{this.busquedasRecientes=e},error:e=>{console.error("Error al cargar b\xFAsquedas recientes desde la API:",e)}})}buscar(){let e=this.searchQuery.trim().toLowerCase();this.paginaActual=0,e===""?this.consultasFiltradas=this.consultas:this.consultasFiltradas=this.consultas.filter(i=>i.titulo.toLowerCase().includes(e)||i.producto.toLowerCase().includes(e))}obtenerConsultasPaginadas(){let e=this.paginaActual*this.consultasPorPagina;return this.consultasFiltradas.slice(e,e+this.consultasPorPagina)}siguientePagina(){(this.paginaActual+1)*this.consultasPorPagina<this.consultasFiltradas.length&&this.paginaActual++}anteriorPagina(){this.paginaActual>0&&this.paginaActual--}irAVistaConsulta(e){let i=this.consultas.find(t=>t.titulo.trim().toLowerCase()===e.trim().toLowerCase());i?this.router.navigate(["/vistaconsulta",i.id]):alert("No se encontr\xF3 una consulta que coincida con esta b\xFAsqueda.")}resaltarCoincidencia(e){if(!this.searchQuery.trim())return e;let i=this.searchQuery.trim(),t=new RegExp(`(${i})`,"gi");return e.replace(t,'<mark class="bg-yellow-200">$1</mark>')}static{this.\u0275fac=function(i){return new(i||s)(b(I),b(H))}}static{this.\u0275cmp=w({type:s,selectors:[["app-consultas"]],standalone:!0,features:[M],decls:26,vars:7,consts:[[1,"max-w-7xl","mx-auto","px-6","mt-6"],[1,"flex","flex-col","sm:flex-row","sm:items-center","justify-between","mb-4","gap-4"],[1,"flex","flex-col","sm:flex-row","sm:items-center","sm:gap-4","w-full","sm:w-auto"],[1,"w-full","sm:w-auto"],[1,"w-full","sm:w-auto","bg-green-100","text-sm","px-4","py-1","rounded-full","border","border-gray-400"],[1,"w-full","sm:w-auto","mt-2","sm:mt-0"],["type","text","placeholder","Buscar",1,"w-full","sm:w-60","border","border-gray-300","rounded-md","px-4","py-1","focus:outline-none",3,"ngModelChange","input","ngModel"],[1,"flex","flex-col","lg:flex-row","gap-6"],[1,"grid","grid-cols-1","sm:grid-cols-2","lg:grid-cols-3","gap-4","w-full"],["class","border border-[#00A99D] rounded-md p-4 bg-orange-50 shadow-sm",4,"ngFor","ngForOf"],[1,"w-full","lg:w-64","border","border-[#00A99D]","p-4","bg-orange-50","rounded-md","h-fit"],[1,"font-semibold","mb-2"],[1,"text-sm","list-disc","list-inside","text-gray-800"],[4,"ngFor","ngForOf"],[1,"flex","flex-col","sm:flex-row","sm:items-center","sm:mt-6","gap-2","sm:gap-4","justify-center","items-center","sm:justify-start","sm:ml-[58%]"],[1,"text-sm","text-gray-600","text-center","sm:text-left"],[1,"flex","gap-2"],[1,"flex","items-center","justify-center","w-9","h-9","rounded-full","border","border-gray-300","bg-white","text-gray-700","hover:bg-green-100","hover:text-green-700","disabled:opacity-50","disabled:cursor-not-allowed","transition","duration-200",3,"click","disabled"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-4","w-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5l7 7-7 7"],[1,"border","border-[#00A99D]","rounded-md","p-4","bg-orange-50","shadow-sm"],[1,"font-semibold","mb-1","text-sm","text-blue-600"],[3,"innerHTML"],[1,"text-xs","text-gray-700","mb-3"],[4,"ngIf"],[1,"flex","justify-between","text-xs","text-gray-500"],[1,"cursor-pointer","hover:underline",3,"routerLink"],[1,"text-blue-600","cursor-pointer","hover:underline",3,"click"]],template:function(i,t){i&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"button",4),l(5," Seleccionar Producto \u25BC "),r()(),n(6,"div",5)(7,"input",6),E("ngModelChange",function(g){return A(t.searchQuery,g)||(t.searchQuery=g),g}),d("input",function(){return t.buscar()}),r()()()(),n(8,"div",7)(9,"div",8),p(10,z,11,7,"div",9),r(),n(11,"div",10)(12,"h4",11),l(13,"\u{1F50D} B\xFAsquedas Recientes"),r(),n(14,"ul",12),p(15,G,3,1,"li",13),r()()(),n(16,"div",14)(17,"span",15),l(18),r(),n(19,"div",16)(20,"button",17),d("click",function(){return t.anteriorPagina()}),f(),n(21,"svg",18),c(22,"path",19),r()(),v(),n(23,"button",17),d("click",function(){return t.siguientePagina()}),f(),n(24,"svg",18),c(25,"path",20),r()()()()()),i&2&&(a(7),F("ngModel",t.searchQuery),a(3),o("ngForOf",t.obtenerConsultasPaginadas()),a(5),o("ngForOf",t.busquedasRecientes),a(3),k(" Mostrar ",t.paginaActual*t.consultasPorPagina+t.obtenerConsultasPaginadas().length," de ",t.consultasFiltradas.length," resultados "),a(2),o("disabled",t.paginaActual===0),a(3),o("disabled",(t.paginaActual+1)*t.consultasPorPagina>=t.consultasFiltradas.length))},dependencies:[D,T,q,j,V,R,N,Q,O,B]})}}return s})();export{ne as ConsultasComponent};
