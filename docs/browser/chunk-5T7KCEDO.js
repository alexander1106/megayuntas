import{c as B,e as z,h as W,r as Y}from"./chunk-VBC45PGF.js";import{a as h}from"./chunk-EWES4JOE.js";import{b as $,d as O,h as H}from"./chunk-Q3OPCDQA.js";import"./chunk-OZO3W66J.js";import{c as _,f as N}from"./chunk-B24EO72Z.js";import{$a as m,Bb as k,Fa as P,Ga as T,Ib as E,Ma as a,Na as g,P as x,U as f,Za as u,_ as D,cc as R,db as o,dc as L,eb as n,fb as I,fc as U,ga as v,gb as j,ha as b,hb as F,ib as C,jb as y,kb as d,rb as w,sb as s,tb as p,ub as S,xb as M,yb as q,zb as A}from"./chunk-HWFM7EIN.js";import"./chunk-5FZOKLP6.js";var J=(()=>{class e{constructor(t){this.http=t,this.baseUrl=h.apiUrl+"/consultas/vista?idConsulta="}obtenerConsulta(t){let i=`${this.baseUrl}${t}`;return this.http.get(i)}static{this.\u0275fac=function(i){return new(i||e)(f(_))}}static{this.\u0275prov=x({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var K=(()=>{class e{constructor(t){this.http=t,this.apiUrl=h.apiUrl+"/busquedas/recientes"}obtenerBusquedasRecientes(){return this.http.get(this.apiUrl)}static{this.\u0275fac=function(i){return new(i||e)(f(_))}}static{this.\u0275prov=x({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var Q=(()=>{class e{constructor(t){this.http=t,this.apiUrl=`${h.apiUrl}/comentarios`}obtenerComentarios(t){return this.http.get(`${this.apiUrl}?idConsulta=${t}`)}enviarComentario(t){return this.http.post(this.apiUrl,t)}static{this.\u0275fac=function(i){return new(i||e)(f(_))}}static{this.\u0275prov=x({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function it(e,l){if(e&1&&I(0,"img",36),e&2){let t=d().$implicit;m("src","assets/publicaciones_img/"+t.imagenes[0],T)}}function nt(e,l){if(e&1&&(o(0,"div",30)(1,"div",31)(2,"div",32)(3,"h3",33),s(4),n(),I(5,"div",34),n(),u(6,it,1,1,"img",35),n()()),e&2){let t=l.$implicit;a(4),p(t.tituloPaso),a(),m("innerHTML",t.descripcionPaso,P),a(),m("ngIf",t.imagenes.length>0)}}function ot(e,l){if(e&1&&(o(0,"div"),u(1,nt,7,3,"div",29),n()),e&2){let t=d(2);a(),m("ngForOf",t.mostrarTodosLosPasos?t.pasosAgrupados:t.pasosAgrupados.slice(0,2))}}function rt(e,l){if(e&1){let t=C();o(0,"div",37)(1,"button",38),y("click",function(){v(t);let r=d(2);return b(r.verMasPasos())}),s(2," Ver m\xE1s... "),n()()}}function at(e,l){if(e&1&&(o(0,"div",40)(1,"div",41)(2,"div",42),s(3,"\u{1F464}"),n(),o(4,"div")(5,"p",43),s(6),n(),o(7,"p",14),s(8),n(),o(9,"p",44),s(10),n()()()()),e&2){let t=l.$implicit;a(6),p(t.nombre),a(2),p(t.fecha),a(2),p(t.texto)}}function st(e,l){if(e&1&&(o(0,"div"),u(1,at,11,3,"div",39),n()),e&2){let t=d(2);a(),m("ngForOf",t.comentarios)}}function lt(e,l){e&1&&(o(0,"p",45),s(1,"No hay comentarios a\xFAn."),n())}function ct(e,l){if(e&1){let t=C();j(0),o(1,"div",10)(2,"h2",11),s(3),n(),o(4,"button",12)(5,"span",13),s(6,"\u{1F4E4}"),n(),s(7," Exportar "),n()(),o(8,"p",14),s(9),n(),o(10,"p",15),s(11),n(),u(12,ot,2,1,"div",16)(13,rt,3,0,"div",17),o(14,"div",18)(15,"div",19)(16,"div",20),s(17,"\u{1F464}"),n(),o(18,"div",21)(19,"textarea",22),A("ngModelChange",function(r){v(t);let c=d();return q(c.comentario,r)||(c.comentario=r),b(r)}),n(),o(20,"div",23)(21,"button",24),s(22," \u{1F60A} "),n(),o(23,"button",25),y("click",function(){v(t);let r=d();return b(r.comentar())}),s(24," Comentar "),n()()()()(),o(25,"div",26)(26,"div",27),s(27),n(),o(28,"div",28),u(29,st,2,1,"div",5)(30,lt,2,0,"ng-template",null,1,E),n()(),F()}if(e&2){let t=w(31),i=d();a(3),p(i.consulta.tituloConsulta),a(6),p(i.consulta.nombreProducto),a(2),p(i.consulta.descripcionConsulta),a(),m("ngIf",i.pasosAgrupados.length>0),a(),m("ngIf",i.pasosAgrupados.length>2&&!i.mostrarTodosLosPasos),a(6),M("ngModel",i.comentario),a(8),S(" Comentarios (",i.comentarios.length,") "),a(2),m("ngIf",i.comentarios.length>0)("ngIfElse",t)}}function mt(e,l){if(e&1&&(o(0,"div")(1,"p",46),s(2),n()()),e&2){let t=d(2);a(2),p(t.error)}}function dt(e,l){e&1&&(o(0,"p",47),s(1,"Cargando consulta..."),n())}function ut(e,l){if(e&1&&u(0,mt,3,1,"div",5)(1,dt,2,0,"ng-template",null,2,E),e&2){let t=w(2),i=d();m("ngIf",i.error)("ngIfElse",t)}}function pt(e,l){if(e&1){let t=C();o(0,"li")(1,"span",48),y("click",function(){let r=v(t).$implicit,c=d();return b(c.irAVistaConsulta(r.titulo))}),s(2),n()()}if(e&2){let t=l.$implicit;a(2),S(" ",t.titulo," ")}}var Et=(()=>{class e{constructor(t,i,r,c,X){this.vistaconsultaService=t,this.busquedasService=i,this.comentariosService=r,this.route=c,this.router=X,this.busquedasRecientes=[],this.comentario="",this.mostrarTodosLosPasos=!1,this.error="",this.comentarios=[],this.idConsulta=0,this.pasosAgrupados=[]}ngOnInit(){this.idConsulta=Number(this.route.snapshot.paramMap.get("id")),isNaN(this.idConsulta)?this.error="ID de consulta inv\xE1lido.":(this.vistaconsultaService.obtenerConsulta(this.idConsulta).subscribe({next:t=>{this.consulta=t,this.pasosAgrupados=this.agruparPasosPorTituloYDescripcion(this.consulta.pasos)},error:()=>{this.error="No se pudo cargar la consulta. Verifica tu conexi\xF3n."}}),this.comentariosService.obtenerComentarios(this.idConsulta).subscribe({next:t=>{this.comentarios=t.map(i=>({nombre:`${i.nombres} ${i.apellidos}`,fecha:new Date(i.fecha).toLocaleString("es-PE",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),texto:i.comentario}))},error:t=>{console.error("Error al obtener comentarios:",t)}})),this.busquedasService.obtenerBusquedasRecientes().subscribe({next:t=>{this.busquedasRecientes=t},error:t=>{console.error("Error al obtener b\xFAsquedas recientes:",t)}})}comentar(){let t=this.comentario.trim();if(t){let i={nombre:"",fecha:new Date().toLocaleString(),texto:t};this.comentarios.unshift(i),this.comentario=""}}verMasPasos(){this.mostrarTodosLosPasos=!0}irAVistaConsulta(t){this.consulta&&this.consulta.tituloConsulta.trim().toLowerCase()===t.trim().toLowerCase()?this.router.navigate(["/vistaconsulta",this.idConsulta]):alert("No se encontr\xF3 la consulta con ese t\xEDtulo.")}agruparPasosPorTituloYDescripcion(t){let i=new Map;return t.forEach(r=>{let c=r.tituloPaso+"|"+r.descripcionPaso;i.has(c)?r.imagenPaso&&i.get(c).imagenes.push(r.imagenPaso):i.set(c,{tituloPaso:r.tituloPaso,descripcionPaso:r.descripcionPaso,imagenes:r.imagenPaso?[r.imagenPaso]:[]})}),Array.from(i.values())}static{this.\u0275fac=function(i){return new(i||e)(g(J),g(K),g(Q),g($),g(O))}}static{this.\u0275cmp=D({type:e,selectors:[["app-vistaconsulta"]],standalone:!0,features:[k],decls:10,vars:3,consts:[["cargandoConsulta",""],["sinComentarios",""],["cargando",""],[1,"container","mx-auto","px-4","py-6","flex","flex-col","lg:flex-row","gap-4"],[1,"w-full","lg:w-3/4"],[4,"ngIf","ngIfElse"],[1,"w-full","lg:w-64","border","border-green-500","p-4","bg-orange-50","rounded-md","h-fit"],[1,"font-semibold","mb-2"],[1,"text-sm","list-disc","list-inside","text-gray-800"],[4,"ngFor","ngForOf"],[1,"flex","items-center","justify-between","flex-wrap","gap-2","sm:gap-4","mb-2"],[1,"text-lg","font-semibold"],[1,"flex","items-center","px-3","py-1","bg-orange-300","hover:bg-orange-400","rounded-md","text-sm"],[1,"mr-1"],[1,"text-xs","text-gray-500"],[1,"mt-2","text-sm","text-gray-700","text-justify"],[4,"ngIf"],["class","mt-2",4,"ngIf"],[1,"mt-8","bg-white","shadow-md","border","border-gray-200","rounded-xl","p-5"],[1,"flex","items-start","gap-4"],[1,"text-3xl","pt-1","text-gray-500"],[1,"flex-1","relative"],["placeholder","Escribe tu comentario aqu\xED...",1,"w-full","h-28","resize-none","border","border-gray-300","rounded-xl","p-4","pr-32","text-sm","shadow-sm","focus:outline-none","focus:ring-2","focus:ring-teal-400","focus:border-transparent","text-justify","placeholder:text-gray-400","placeholder:text-sm","placeholder:align-top","placeholder:leading-5",3,"ngModelChange","ngModel"],[1,"absolute","bottom-3","left-4","right-4","flex","items-center","justify-between"],["title","Inserta Emoji",1,"text-xl","hover:scale-110","transition-transform"],[1,"bg-teal-500","hover:bg-teal-600","text-white","text-sm","px-5","py-1.5","rounded-md","shadow-md","transition-all",3,"click"],[1,"mt-10","border","border-gray-400","rounded-md"],[1,"bg-orange-400","text-black","font-semibold","px-4","py-2","text-lg","rounded-t-md"],[1,"bg-white","px-4","py-2","space-y-3","max-h-72","overflow-y-auto"],["class","border border-green-500 p-3 rounded-md mt-4",4,"ngFor","ngForOf"],[1,"border","border-green-500","p-3","rounded-md","mt-4"],[1,"flex","flex-col","sm:flex-row","gap-4"],[1,"flex-1"],[1,"font-semibold","text-sm","mb-1"],[1,"text-sm","text-gray-700","text-justify",3,"innerHTML"],["alt","Imagen paso","class","w-full sm:w-40 max-w-[160px] h-auto object-contain border rounded-md shadow-sm mx-auto sm:mx-0",3,"src",4,"ngIf"],["alt","Imagen paso",1,"w-full","sm:w-40","max-w-[160px]","h-auto","object-contain","border","rounded-md","shadow-sm","mx-auto","sm:mx-0",3,"src"],[1,"mt-2"],[1,"px-3","py-1","bg-teal-400","hover:bg-teal-500","text-white","text-sm","rounded-md",3,"click"],["class","bg-gray-100 p-3 rounded-md shadow-sm",4,"ngFor","ngForOf"],[1,"bg-gray-100","p-3","rounded-md","shadow-sm"],[1,"flex","items-start","gap-3"],[1,"text-4xl"],[1,"font-semibold","text-sm"],[1,"text-sm","mt-1","text-gray-800","text-justify"],[1,"text-sm","text-gray-600","italic"],[1,"text-red-600","text-sm","font-medium"],[1,"text-gray-500","text-sm","italic"],[1,"text-blue-600","cursor-pointer","hover:underline",3,"click"]],template:function(i,r){if(i&1&&(o(0,"div",3)(1,"div",4),u(2,ct,32,9,"ng-container",5)(3,ut,3,2,"ng-template",null,0,E),n(),o(5,"div",6)(6,"h4",7),s(7,"\u{1F50D} B\xFAsquedas Recientes"),n(),o(8,"ul",8),u(9,pt,3,1,"li",9),n()()()),i&2){let c=w(4);a(2),m("ngIf",r.consulta)("ngIfElse",c),a(7),m("ngForOf",r.busquedasRecientes)}},dependencies:[U,R,L,Y,B,z,W,H,N]})}}return e})();export{Et as VistaconsultaComponent};
